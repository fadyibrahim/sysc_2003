M:\Sysc 2003\Assignment 3\sci0api.lst - generated by MGTEK Assembler ASM12 V1.26 Build 144 for WIN32 (x86) - Fri Feb 22 19:47:29 2013

    1:                                 ;******************************************************************************************************
    2:                                 ;SCI0 Routines - Lloyd Atkinson, Nov 2003
    3:                                 ;******************************************************************************************************
    4:                                 
    5:                                 ;Note: Simulator automatically matches to any baud rate
    6:          =00000034              BAUD9600        EQU     0052    ;9600 Divider  (8MHz ECLK) Used for Mon12
    7:          =0000001A              BAUD19K         EQU     0026    ;19200 Divider (8MHz ECLK) Used for NoICE
    8:                                 
    9:                                 ;***********************************************************************
   10:                                 ;void setbaud(int baudRate)
   11:                                 ;
   12:                                 ;Sets up SCI0 with baud rate specified in D
   13:                                 ;Sets up SC0CR1 with Wakeup By Address Mark and Long Idle Time enabled
   14:                                 ;Enables Receiver & Transmitter
   15:                                 ;***********************************************************************
   16:                                 
   17:     0000                        setbaud:
   18:                                         ;Setup SCI for receive
   19:                                                 ;Set Baud Rate
M:\Sysc 2003\Assignment 3\sci0api.asm(20): Error A2038: col(14) 'sc0bdh': undefined symbol
   20:                                                 staa SC0BDH
M:\Sysc 2003\Assignment 3\sci0api.asm(21): Error A2038: col(14) 'sc0bdl': undefined symbol
   21:                                                 stab SC0BDL
   22:                                                 ;Setup SC0CR1 with Wakeup By Address Mark and Long Idle Time enabled
M:\Sysc 2003\Assignment 3\sci0api.asm(23): Error A2038: col(20) 'sc0cr1': undefined symbol
   23:                                                 movb #$0C, SC0CR1
   24:                                                 ;Enable Receiver&Transmitter
M:\Sysc 2003\Assignment 3\sci0api.asm(25): Error A2038: col(14) 'sc0cr2': undefined symbol
   25:                                                 bset SC0CR2, #$0C
   26:     0000 3D                             rts
   27:                                 
   28:                                 ;*********************************************************************************
   29:     0001                        putStr_sc0: 
   30:                                 ;Accepts: Start address of output string in Y
   31:                                 ;Returns: Nothing
   32:                                 ;Destroys: Nothing
   33:                                 ;Given a start address in Y, outputs string until 
   34:                                 ;it finds null, it does not ouput the null
   35:                                 ;*********************************************************************************
   36:     0001 3B                             pshd
   37:                                 
   38:                                         ;Init Counter
   39:     0002 86 00                          ldaa #0
   40:     0004                        PutStr: 
   41:                                         ;Get character
   42:     0004 E6 EC                          ldab A, Y
   43:                                         ;Put Character
   44:     0006 17 11                          jsr putChar_sc0
   45:                                         ;Test for Done
   46:     0008 C1 00                          cmpb #0
   47:     000A 27 03                          beq DonePutStr
   48:                                                 ;Not done yet
   49:     000C 42                                     inca
   50:     000D 20 F5                                  bra PutStr
   51:                                 
   52:     000F                        DonePutStr:
   53:     000F 3A                             puld
   54:     0010 3D                             rts
   55:                                         
   56:                                 ;*********************************************************************************
   57:     0011                        putChar_sc0: 
   58:                                 ;Accepts: Character for output in B
   59:                                 ;Returns: Nothing
   60:                                 ;Destroys: Nothing
   61:                                 ;Given a character in B, polls 'Transmit Data Register Empty Flag'(TDRE) of SC0SR1
   62:                                 ;until it goes high.  Then places new character in SC0DRL data register for output
   63:                                 ;*********************************************************************************      
   64:                                         ;If SC0SR1 Bit 7 is high then we may write another byte for output
M:\Sysc 2003\Assignment 3\sci0api.asm(65): Error A2038: col(14) 'sc0sr1': undefined symbol
   65:                                         brclr SC0SR1, #$80, putChar_sc0
   66:                                         ;Write next character to the Data Register
M:\Sysc 2003\Assignment 3\sci0api.asm(67): Error A2038: col(13) 'sc0drl': undefined symbol
   67:                                         stab SC0DRL
   68:     0011 3D                             rts
   69:                                 
   70:                                 
   71:                                 ;*********************************************************************************
   72:     0012                        getChar_sc0: 
   73:                                 ;Accepts: Nothing
   74:                                 ;Returns: Input character from SCI0
   75:                                 ;Destroys: B
   76:                                 ;Polls 'Receive Data Register Flag' (RDRF) of SC0SR1 until it goes high.
   77:                                 ;Then places new character from SC0DRL in B
   78:                                 ;*********************************************************************************      
   79:                                         ;If SC0SR1 Bit 5 is high, there is a new character in SC0DRL
M:\Sysc 2003\Assignment 3\sci0api.asm(80): Error A2038: col(14) 'sc0sr1': undefined symbol
   80:                                         brclr SC0SR1, #$20, getChar_sc0
   81:                                         ;Read in new character from the Data Register
M:\Sysc 2003\Assignment 3\sci0api.asm(82): Error A2038: col(13) 'sc0drl': undefined symbol
   82:                                         ldab SC0DRL
   83:     0012 3D                             rts

Symbols:
doneputstr                      *0000000f
getchar_sc0                     *00000012
putchar_sc0                     *00000011
putstr                          *00000004
sc0bdh                          ?00000000
sc0bdl                          ?00000000
sc0cr1                          ?00000000
sc0cr2                          ?00000000
sc0drl                          ?00000000
sc0sr1                          ?00000000

